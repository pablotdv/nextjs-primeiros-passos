# dojo-nextjs-getting-started

# Setup inicial
## Pré requisitos

- Visual Studio Code: https://code.visualstudio.com/docs/?dv=win
- NVM: https://github.com/coreybutler/nvm-windows/releases
- git: https://git-scm.com/download/win

## Instalar o Node
```sh
nvm install latest
nvm use latest
```

## Atualizar o npm
```sh
npm install -g npm@10.1.0
```

## Habilitar execução de script no windows
Abrir terminal do powershell em modo administrativo
```sh
Set-ExecutionPolicy -ExecutionPolicy Unrestricted
```

## Iniciando o projeto em next js
Fonte: https://nextjs.org/docs/getting-started/installation
```sh
npx create-next-app@latest .
```

## Executando o projeto 
```
npm install
npm run dev
```
Para acessar, basta abrir http://localhost:3000 no navegador.

# Evoluindo o exemplo
Fonte: https://nextjs.org/learn/basics/create-nextjs-app

## Alterar `app/page.js` 
```jsx
import styles from './page.module.css'

export default function Home() {
  return (
    <main className={styles.main}>
      <h1>Olá NextJS</h1>
    </main>
  )
}
```

## Navegando entre páginas
Alterar `app/layout.js`
```jsx
import Link from 'next/link'
import './globals.css'
import { Inter } from 'next/font/google'

const inter = Inter({ subsets: ['latin'] })

export const metadata = {
  title: 'Create Next App',
  description: 'Generated by create next app',
}

export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <body className={inter.className}>
        <header>
          <nav>
            <ul>
              <li><Link href="/">Home</Link></li>
              <li><Link href="/sobre">Sobre</Link></li>
            </ul>
          </nav>
        </header>
        <section>
          {children}
        </section>
      </body>
    </html>
  )
}
```

Estilizando o header
Fonte: https://www.w3schools.com/Css/css_navbar.asp
Fonte II: https://www.w3schools.com/Css/tryit.asp?filename=trycss_navbar_horizontal_responsive
- Alterar `app\globals.css`
```css
body {margin: 0;}

ul.topnav {
  list-style-type: none;
  margin: 0;
  padding: 0;
  overflow: hidden;
  background-color: #333;
}

ul.topnav li {float: left;}

ul.topnav li a {
  display: block;
  color: white;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
}

ul.topnav li a:hover:not(.active) {background-color: #111;}

ul.topnav li a.active {background-color: #04AA6D;}

ul.topnav li.right {float: right;}

@media screen and (max-width: 600px) {
  ul.topnav li.right, 
  ul.topnav li {float: none;}
}

section.main {
  padding: 0 16px;
}
```
- Alterar o header do layout para
```jsx
<header>
  <nav>
    <ul className='topnav'>
      <li><Link href="/">Home</Link></li>
      <li className='right'><Link href="/sobre">Sobre</Link></li>
    </ul>
  </nav>
</header>
```

## Adicionando listagem de contatos
Fonte: https://www.w3schools.com/Css/css_table_responsive.asp
Criar página `app\contatos\page.js`
```jsx
import styles from "./contatos.module.css"
export default function Page() {
  return (
    <>
      <h1>Olá NextJS - Contatos Page</h1>
      <table className={styles.customers}>
        <thead>
          <tr>
            <th>Nome</th>
            <th>Endereço</th>
            <th>Telefone</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Pablo</td>
            <td>Rua da Maciota</td>
            <td>+55 51 98765-9876</td>
          </tr>
          <tr>
            <td>Pablo</td>
            <td>Rua da Maciota</td>
            <td>+55 51 98765-9876</td>
          </tr>
          <tr>
            <td>Pablo</td>
            <td>Rua da Maciota</td>
            <td>+55 51 98765-9876</td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <td colSpan={3}>Total contatos: 3</td>
          </tr>
        </tfoot>
      </table>
    </>
  )
}
```
Criar folha de estilo `app\contatos\contatos.module.css`
```css
.customers {
    font-family: Arial, Helvetica, sans-serif;
    border-collapse: collapse;
    width: 100%;
}

.customers td,
.customers th {
    border: 1px solid #ddd;
    padding: 8px;
}

.customers tr:nth-child(even) {
    background-color: #f2f2f2;
}

.customers tr:hover {
    background-color: #ddd;
}

.customers th {
    padding-top: 12px;
    padding-bottom: 12px;
    text-align: left;
    background-color: #04AA6D;
    color: white;
}
```

## Criando uma api para retornar contatos

Criar arquivo `pages\api\contatos.js`
```
const contatos = [
    {
        id: 1,
        nome: "Pablo 1",
        endereco: "Rua 1",
        telefone: "+55 55 98765-9876"
    },
    {
        id: 2,
        nome: "Pablo 2",
        endereco: "Rua 2",
        telefone: "+55 55 98765-9876"
    },
    {
        id: 3,
        nome: "Pablo 3",
        endereco: "Rua 3",
        telefone: "+55 55 98765-9876"
    },
    {
        id: 4,
        nome: "Pablo 4",
        endereco: "Rua 4",
        telefone: "+55 55 98765-9876"
    }]
export default function handler(req, res) {
    res.status(200).json(contatos);
}
```

Listando os contatos da api na tabela de contatos
```jsx
import styles from "./contatos.module.css"

async function buscarContatos() {
  const resposta = await fetch("http://localhost:3000/api/contatos");
  return await resposta.json();
}

export default async function Page() {
  const contatos = await buscarContatos();
  return (
    <>
      <h1>Olá NextJS - Contatos Page</h1>
      <table className={styles.customers}>
        <thead>
          <tr>
            <th>Nome</th>
            <th>Endereço</th>
            <th>Telefone</th>
          </tr>
        </thead>
        <tbody>
          {contatos.map((contato) =>
            <tr key={contato.id}>
              <td>{contato.nome}</td>
              <td>{contato.endereco}</td>
              <td>{contato.telefone}</td>
            </tr>)
          }
        </tbody>
        <tfoot>
          <tr>
            <td colSpan={3}>Total contatos: {contatos.length}</td>
          </tr>
        </tfoot>
      </table>
    </>
  )
}
```

## usando sqlite para armazenar dados

baixar e configurar o client do sqlite

https://www.sqlite.org/download.html

colocar os executais do sqlite na pasta `c:\tools` e adicionar a pasta nas variáveis de ambiente do windows
![Variáveis de ambiente](assets/image.png)

Criando a primeira tablea
```sh
sqlite3 .\data\database.db
```
```sql
create table contatos (
  id int primary key,
  nome varchar(100),
  endereco text,
  telefone text
);
```
```sql
insert into contatos (id, nome, endereco, telefone) values (1, 'Contato 1', 'Rua 1', '+1 55 98765-98765');
insert into contatos (id, nome, endereco, telefone) values (2, 'Contato 2', 'Rua 2', '+2 55 98765-98765');
insert into contatos (id, nome, endereco, telefone) values (3, 'Contato 3', 'Rua 3', '+1 55 98765-98765');
insert into contatos (id, nome, endereco, telefone) values (4, 'Contato 4', 'Rua 4', '+1 55 98765-98765');
```
```sql
select * from contatos;
```

## buscando os contatos na api

alterar `pages\api\contatos.js`

```js
const sqlite3 = require('sqlite3').verbose();
let db = new sqlite3.Database('./data/database.db');
export default function handler(req, res) {
    db.all(`SELECT id, nome, endereco, telefone FROM contatos`, (err, rows) => {
        if (err) {
            console.error(err.message);
            res.status(500).send(err.message);
            return;
        }
        res.json(rows); 
    });
}
```

https://www.sqlitetutorial.net/sqlite-nodejs/connect/
